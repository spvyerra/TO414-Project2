---
title: "FinalProject"
author: "Joshua Sum"
date: "2/22/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Potential Business Questions
- What is the ideal Shark Tank pitch that gives a competitor the best shot of getting funded at the highest valuation?
- Which target should you try to tailor your pitch to, depending on what your company does?

# Shark Tank Data
We obtained our data from a Kaggle project https://www.kaggle.com/zabonpan/shark-tank-pitches-deals-season-111
```{r}
data <- read.csv("SharkTankData.csv")
data$Episode <- as.factor(data$Episode)
data$Deal <- as.factor(data$Deal)
data$Category <- as.factor(data$Category)
data$Entrepreneur.Gender <- as.factor(data$Entrepreneur.Gender)
data$ASK_Equity <- as.numeric(substr(data$ASK_Equity,1,nchar(data$ASK_Equity)-1))/100
data$ASK_Amount <- as.numeric(gsub(",", "", data$ASK_Amount))
data$ASK_Valuation <- as.numeric(gsub(",", "", data$ASK_Valuation))
data$DEAL_Equity <- as.numeric(substr(data$DEAL_Equity,1,nchar(data$DEAL_Equity)-1))/100
data$DEAL_Amount <- as.numeric(gsub(",", "", data$DEAL_Amount))
data$DEAL_Valuation <- as.numeric(gsub(",", "", data$DEAL_Valuation))
data$Royalty <- as.factor(data$Royalty)
data$Loan <- as.factor(as.numeric(data$Loan))
data$Barbara.Corcoran <- as.factor(data$Barbara.Corcoran)
data$Mark.Cuban <- as.factor(data$Mark.Cuban)
data$Lori.Greiner <- as.factor(data$Lori.Greiner)
data$Robert.Herjavec <- as.factor(data$Robert.Herjavec)
data$Daymond.John <- as.factor(data$Daymond.John)
data$Kevin.O.Leary <- as.factor(data$Kevin.O.Leary)
data$Guest <- as.factor(data$Guest)
data$State <- NULL
data$Business <- NULL
data$Description <- NULL
data$Notes <- NULL
data$Investment.shark <- as.numeric(gsub(",", "", data$Investment.shark))

# Taking subset of season 5 onwards
data <- subset(data, Season >= 5)
data$Season <- as.factor(data$Season)

summary(data)
```

## Getting Data Ready for Analysis

```{r}
# Using model.matrix to convert all the factors to dummy variables
# We are converting all of the factors into dummy variables as the input into knn has to be numeric

shark_matr <- as.data.frame(model.matrix(~.-1,data))

# Randomize the rows in the data (shuffling the rows)
set.seed(12345)
shark_rand <- shark_matr[sample(nrow(shark_matr)),]

#Normalize the data
normalize <- function(x) {
  return ((x - min(x)) / (max(x) - min(x)))
}

# we are going to normalize everything 
shark_norm <- as.data.frame(lapply(shark_rand, normalize))
```

## Getting Train and Test Samples

```{r}
# Selects 10000 random rows for test data
test_set <- sample(1:nrow(shark_norm), 350) 
# Depending on R-version and computer, different rows may be selected. 
# If that happens, results are different. 

# Create a train set and test set
#First the predictors - all columns except the Deal column
shark_train <- shark_norm[-test_set, -match("Deal",names(shark_norm))]
shark_test <- shark_norm[test_set, -match("Deal",names(shark_norm))]

#Now the response (aka Labels) - only the yyes column
shark_train_labels <- shark_norm[-test_set, "Deal"]
shark_test_labels <- shark_norm[test_set, "Deal"]
```

## Creating a Logistic Regression Model

```{r}
linear_model = glm(shark_train_labels ~ ., data = shark_train, family ="binomial")
summary(linear_model)
results <- shark_test
results$pred_glm <- predict(linear_model, newdata = shark_test, type = "response")
results$pred_glm <- as.factor(ifelse(results$pred_glm > 0.5, 1, 0))
confusionMatrix(results$pred_glm, as.factor(shark_test_labels), positive = "1")
```
